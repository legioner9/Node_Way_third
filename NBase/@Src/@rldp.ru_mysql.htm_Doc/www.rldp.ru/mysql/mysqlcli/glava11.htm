<HTML>
<HEAD>
  <TITLE>Проблемы и общие ошибки</TITLE>
  <META NAME="Author" CONTENT="Alexey V. Pautov">
  <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=koi8-r">
  <META NAME="GENERATOR" CONTENT="Dos Navigator 1.51.04/DOS.">
</HEAD>

<BODY>

<script type="text/javascript">
nN = navigator.appName;
function fsearch(str)
{
  if (document.fform.myradio[0].checked) {
     open('../../../yandex.ru/sitesearch@text=' + str + '&site=' +
          document.location.hostname);
  } else {open('../../../yandex.ru/sitesearch@text=' + str);}
}

function MouseUpHandler(e)
{
  if (nN == 'Netscape' || nN == 'Opera') {
     if (document.getSelection()) {
        str = document.getSelection();
        newstr = str.replace(/\n+/g, ' ');
        str = newstr.replace(/\ +/g, ' ');
        if (str.length > 100) {
           var i;
           i = 0;
           str = str.slice(0, 100);
           i = str.lastIndexOf(' ');
           if (i > 0){str = str.slice(0, i);}
        }
        document.fform.strf.value = str;
     }
  } else if(nN == 'Microsoft Internet Explorer') {
    if (document.selection.createRange()) {
       var range = document.selection.createRange();
       var str = range.text;
    }
    if (str) {
       str = str.replace(/\ +/g, " ");
       document.fform.strf.value = str;
    }
  }
  return true;
}
if (window.Event) {document.captureEvents(Event.MOUSEUP);}
document.onmouseup = MouseUpHandler;
</script>

<center><table><tr><td><a href="../../default.htm">
<IMG SRC="../../img/b_book.gif" ALT="RussianLDP" HEIGHT=48 WIDTH=55
ALIGN=ABSCENTER></a></td>

<td><!--Rating@Mail.ru COUNTEr-->
<a target=_top href="../../../top.mail.ru/jump@from=1364238">
<img src="../../../d1.cd.b4.a1.top.list.ru/counter@id=1364238;t=230"
border=0 height=31 width=88 alt="Рейтинг@Mail.ru"/></a>
</td><!--/COUNTER-->

<td><!-- begin of Top100 code -->
<script id="top100Counter" type="text/javascript"
src="../../../cnt.rambler.ru/top100.jcn@1448139"></script>
<noscript><a href="../../../top100.rambler.ru/top100/default.htm">
<img src="../../../cnt.rambler.ru/top100.cnt@1448139" alt="Rambler's Top100"
width="81" height="63" border="0" /></a></noscript>
<!-- end of Top100 code --></td>

<td><!-- HotLog -->
<script type="text/javascript" language="javascript">
hotlog_js="1.0";
hotlog_r=""+Math.random()+"&s=525943&im=127&r="+escape(document.referrer)+
"&pg="+escape(window.location.href);
document.cookie="hotlog=1; path=/"; hotlog_r+="&c="+(document.cookie?"Y":"N");
</script>
<script type="text/javascript" language="javascript1.1">
hotlog_js="1.1";hotlog_r+="&j="+(navigator.javaEnabled()?"Y":"N")
</script>

<script type="text/javascript" language="javascript1.2">
hotlog_js="1.2";
hotlog_r+="&wh="+screen.width+'x'+screen.height+"&px="+
(((navigator.appName.substring(0,3)=="Mic"))?
screen.colorDepth:screen.pixelDepth)</script>

<script type="text/javascript" language="javascript1.3">
hotlog_js="1.3"</script>
<script type="text/javascript" language="javascript">
hotlog_r+="&js="+hotlog_js;
document.write("<a href='../../../click.hotlog.ru/@525943' target='_top'>
<img "+" src='http://hit27.hotlog.ru/cgi-bin/hotlog/count?"+
hotlog_r+"&' border=0 width=88 height=31 alt=HotLog><\/a>")</script>

<noscript>
<a href="../../../click.hotlog.ru/@525943" target="_top">
<img src="../../../hit27.hotlog.ru/cgi-bin/hotlog/count@s=525943&im=127"
border="0" width="88" height="31" alt="HotLog"></a></noscript></td>
<!-- /HotLog -->

<td><!--LiveInternet counter--><script type="text/javascript"><!--
document.write("<a href='../../../www.liveinternet.ru/click' "+
"target=_blank><img src='http://counter.yadro.ru/hit?t52.15;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";"+Math.random()+"' alt='' title='LiveInternet: показано число просмотров и"+
" посетителей за 24 часа' "+"border=0 width=88 height=31><\/a>")//-->
</script></td></tr>
<!--/LiveInternet-->

<tr><td><FONT SIZE=-1><b>WebMoney:&nbsp;</b><br>
WMZ Z294115950220&nbsp;<br>
WMR R409981405661&nbsp;<br>
WME E134003968233&nbsp;</FONT></td>

<td><FONT SIZE=-1><b>Visa&nbsp;</b><br>
4274 3200 2453 6495&nbsp;</FONT></td>
</tr></table></center>
<P><index><table><tr><td>

<H1><A NAME="Problems">11 Проблемы и общие ошибки</A></H1>
<P>Эта глава описывает некоторые общие проблемы и сообщения об ошибках, с
которыми пользователи столкнулись. Вы узнаете, как точно определить
происходящее, и что делать, чтобы решить возникшую проблему. Вы также найдете
здесь соответствующие решения для некоторых общих проблем.</P>

<H2><A NAME="What_is_crashing">11.1 Как определять, что вызывает проблемы</A>
</H2>
<P>Когда Вы сталкиваетесь с проблемами, первое, что Вы должны сделать, это
однозначно выяснить, которая программа или часть оборудования
вызывает данные проблемы.</P>

<UL><LI>Если Вы имеете один из следующих признаков, то это, вероятно,
аппаратные средства (подобно памяти, системной плате, CPU или жесткому
диску) или ядерная проблема:

<UL><LI>Клавиатура не работает. Это может обычно проверяться, нажимая Caps
Lock. Если индикатор Caps Lock не изменяется, Вы должны заменить Вашу
клавиатуру. При выполнении этого, Вы должны попробовать перезагрузить Ваш
компьютер и проверить все кабели, идущие на клавиатуру.

<LI>Указатель мышки не двигается.
<LI>Машина не отвечает на сетевые запросы с удаленной машины.
<LI>Различные, не связанные друг с другом, программы не ведут себя правильно.

<LI>Если Ваша система неожиданно перезагружена (дефектная программа уровня
пользователя никогда не может этого сделать).</UL>

В этом случае Вы должны начать с проверки всех Ваших кабелей и выполнить
какую-нибудь диагностическую программу, чтобы проверить Ваши аппаратные
средства! Вы должны также проверить, имеются ли любые заплаты, модификации
или сервисные пакеты для Вашей операционной системы, которые могли бы,
вероятно, решить эти проблемы. Проверьте также, что все Ваши библиотеки
(подобно glibc) современны. Всегда хорошо использовать машину с памятью ECC,
чтобы обнаружить проблемы памяти пораньше.

<LI>Если Ваша клавиатура блокирована, Вы можете быть способны исправить это,
регистрируясь с другой машины и выполняя <CODE>kbd_mode -a</CODE>.

<LI>Пожалуйста, исследуйте Ваш журнал системы (нечто вроде /var/log/messages)
для поиска причин Ваших проблем. Если Вы думаете, что проблема в MySQL, Вы
должны также исследовать журналы MySQL.

<LI>Если Вы не думаете, что имеете аппаратные проблемы, Вы должны попробовать
выяснить, которая программа вызывает проблемы. Попробуйте использовать
<CODE>top</CODE>, <CODE>ps</CODE>, <CODE>taskmanager</CODE> или некоторую
подобную программу, чтобы установить, которая программа занимает весь CPU
или блокирует машину.

<LI>Проверьте с помощью <CODE>top</CODE>, <CODE>df</CODE> или подобной
программы, не исчерпана ли память, место на диске или иной критический ресурс.

<LI>Если проблема в некотором процессе, вышедшем из-под контроля, Вы можете
всегда попробовать уничтожить его.</UL>

<P>Если после того, как Вы исследовали все другие возможности и заключили,
что проблема заключается в клиенте или сервере MySQL, самое время сделать
отчет об ошибке для списка рассылки или группы поддержки. В отчете ошибки
попробуйте дать очень детальное описание того, как система ведет себя, и что
с ней случается. Вы должны также установить, почему Вы думаете, что это
вызвано именно MySQL. Учтите все ситуации в этой главе. Установите любые
проблемы точно, как они появляются, когда Вы исследуете вашу систему.
Используйте метод "вырезать и вставить" для любого вывода, сообщений об
ошибках из программ и журналов.</P>

<P>Если сбоит программа, всегда полезно знать следующее:</P>
<UL><LI>Программа в запросе получила ошибку segmentation fault (core dumped)?
<LI>Программа захватывает CPU целиком и полностью? Проверьте через
<CODE>top</CODE>. Позвольте программе поработать некоторое время, она может
оценивать что-то тяжелое.

<LI>Если это сервер <CODE>mysqld</CODE> вызывает проблемы, Вы можете сделать
<CODE>mysqladmin -u root ping</CODE> или <CODE>mysqladmin -u root
processlist</CODE>?

<LI>Что говорит программа пользователя (попробуйте, например,
<CODE>mysql</CODE>), когда Вы пробуете соединяться с сервером MySQL? Клиент
зависает? Вы получаете любой вывод из программы?</UL>

<P>При посылке отчета об ошибке Вы должны обязательно следовать правилам,
описанным в этом руководстве.</P>

<H2><A NAME="Common_errors">11.2 Общие ошибки при использовании MySQL</A></H2>
<P>Этот раздел перечисляет некоторые ошибки, с которыми пользователи часто
сталкиваются. Здесь Вы найдете описания ошибок, и как решить проблему.</P>

<H3><A NAME="Error_Access_denied">11.2.1 Ошибка <CODE>Access denied</CODE>
</A></H3>
<P>Обратитесь к разделам
"<A HREF="glava10.htm#Privileges">10.5 Как работает система привилегий</A>" и
особенно "<A HREF="glava10.htm#Access_denied">10.10 Причины ошибки
<CODE>Access denied</CODE></A>".</P>

<H3><A NAME="Gone_away">11.2.2 Ошибка <CODE>MySQL server has gone away</CODE>
</A></H3>
<P>Наиболее общая причина для ошибки <CODE>MySQL server has gone away</CODE>
состоит в том, что у сервера кончилось время ожидания, и он закрыл
подключение. По умолчанию сервер закрывает подключение после 8 часов
отсутствия активности. Вы можете изменять срок, устанавливая переменную
<CODE>wait_timeout</CODE>, когда Вы запускаете <CODE>mysqld</CODE></P>

<P>Другая общая причина получения такой ошибки состоит в том, что Вы закрыли
соединение, а теперь пробуете выполнить запрос на закрытом подключении.</P>

<P>Вы можете проверять, что MySQL работает, выполняя <CODE>mysqladmin
version</CODE> и исследуя uptime.</P>

<P>Если Вы имеете скрипт, Вы только должны снова выдать запрос клиенту, чтобы
сделать автоматическое переподключение.</P>

<P>Вы обычно можете получать следующие коды ошибки в этом случае:</P>
<TABLE BORDER WIDTH="100%">
<TR><TD><CODE>CR_SERVER_GONE_ERROR</CODE></TD><TD>Клиент не может послать
запрос на сервер.</TD></TR>
<TR><TD><CODE>CR_SERVER_LOST</CODE></TD><TD>Клиент не получал ошибку при
записи на сервер, но и не получил полный ответ (или любой ответ) на запрос.
</TD></TR></TABLE>

<P>Вы можете также получать эти ошибки, если Вы посылаете неправильной или
слишком большой запрос серверу. Если <CODE>mysqld</CODE> получает пакет,
который является слишком большим или вне правил, он считает, что что-то
пошло неправильно с клиентом и закрывает подключение. Если Вы нуждаетесь в
больших запросах (например, если Вы работаете с большими столбцами
<CODE>BLOB</CODE>), Вы можете увеличить ограничение запроса, запуская
<CODE>mysqld</CODE> с опцией <CODE>-O max_allowed_packet=#</CODE> (по
умолчанию 1M). Память дополнительного пространства распределена по
требованию, так что <CODE>mysqld</CODE> использует большее количество памяти
только, когда Вы выдаете большой запрос, или когда <CODE>mysqld</CODE> должен
возвратить большую строку результатов!</P>

<H3><A NAME="Can_not_connect_to_server">11.2.3 Ошибка <CODE>Can't connect
to [local] MySQL server</CODE></A></H3>
<P>Клиент MySQL под ОС Unix может соединяться с сервером <CODE>mysqld</CODE>
двумя различными способами: Unix-сокеты, которые подключают через файл в
файловой системе (значение по умолчанию <TT>/tmp/mysqld.sock</TT>) или по
протоколу TCP/IP, который соединяется через номер порта. Unix-сокеты быстрее,
чем TCP/IP, но могут использоваться только при соединении с сервером на том
же самом компьютере. Они применяются, если Вы не определяете hostname, или
если Вы определяете специальное имя <CODE>localhost</CODE>.</P>

<P>Под Windows Вы можете соединяться только через TCP/IP, если сервер
<CODE>mysqld</CODE> запущен под Win95/Win98. Если же использована NT, Вы
можете также соединяться с именованными каналами. Имя такого именованного
канала MySQL. Если Вы не задаете hostname при соединении с сервером, клиент
сначала попробует соединяться с именованным каналом, и если это не работает,
то соединится с TCP/IP портом. Вы можете заставить использовать именованный
канал под Windows, указав точку (<CODE>.</CODE>) как hostname.</P>

<P>Сообщение error (2002) <CODE>Can't connect to ...</CODE> обычно означает,
что не имеется сервера MySQL на системе, что Вы используете неправильный файл
сокета или не тот TCP/IP порт при попытке соединиться с <CODE>mysqld</CODE>.
</P>

<P>Начните с проверки (<CODE>ps</CODE> или через администратор задач под
Windows), что вообще имеется процесс, управляющий <CODE>mysqld</CODE> на
Вашем сервере! Если не имеется никакого процесса <CODE>mysqld</CODE>, Вы
должны обратиться к администратору и попросить его запустить сервер.

<P>Если процесс <CODE>mysqld</CODE> работает, Вы можете проверять сервер,
пробуя различные подключения (номер порта и имя пути сокета):</P>
<PRE>
shell&#62; mysqladmin version
shell&#62; mysqladmin variables
shell&#62; mysqladmin -h `hostname` version variables
shell&#62; mysqladmin -h `hostname` --port=3306 version
shell&#62; mysqladmin -h 'ip for your host' version
shell&#62; mysqladmin --socket=/tmp/mysql.sock version
</PRE>

<P>Обратите внимание на использование апострофов вместо кавычек с командой
<CODE>hostname</CODE>: они заставляют вывод <CODE>hostname</CODE> (то есть,
текущий hostname) вставиться в <CODE>mysqladmin</CODE>.</P>

<P>Имеются некоторые причины, по которым может происходить ошибка <CODE>Can't
connect to local MySQL server</CODE>:</P>

<UL><LI><CODE>mysqld</CODE> не запущен.
<LI>Вы работаете на системе, которая использует MIT-PTHREADS. Если Вы
работаете на системе, которая не имеет местной поддержки потоков,
<CODE>mysqld</CODE> использует пакет MIT-pthreads. Однако, все версии
MIT-pthreads не поддерживают Unix-сокеты. На системе без поддержки сокетов Вы
должны всегда определять hostname явно при соединении с сервером. Попробуйте
использовать эту команду, чтобы Ваше проверить подключение:
<PRE>
shell&#62; mysqladmin -h `hostname` version
</PRE>

<LI>Кто-то удалил Unix-сокет, использовавшийся <CODE>mysqld</CODE>, (по
умолчанию это <TT>/tmp/mysqld.sock</TT>). Вы могли бы иметь задачу для
планировщика <CODE>cron</CODE>, которая удаляет старые файлы из каталога
<TT>/tmp</TT>, и сокет вместе с ними). Вы можете всегда выполнять
<CODE>mysqladmin version</CODE> и проверять, что каталог сокета в самом деле
существует. Подробности в разделе
"<A HREF="#Problems_with_mysql.sock">11.4.5 Как защитить или
сменить файл сокета MySQL <TT>/tmp/mysql.sock</TT></A>".

<LI>Вы запустили <CODE>mysqld</CODE> с опцией
<CODE>--socket=/path/to/socket</CODE>. Если Вы изменяете имя пути сокета для
сервера, не забудьте поставить об этом в известность клиентов. Вы можете
сделать это, обеспечивая путь к сокету как параметр клиента. Подробности в
разделе "<A HREF="#Problems_with_mysql.sock">11.4.5 Как защитить
файл сокета MySQL <TT>/tmp/mysql.sock</TT></A>".

<LI>Вы используете Linux, и один поток свалился (core dumped). В этом случае
Вы должны уничтожить другие потоки <CODE>mysqld</CODE> (например, скриптом
<CODE>mysql_zap</CODE> прежде, чем Вы сможете запустить новый сервер MySQL).

<LI>Вы, возможно, не имеете прав доступа на чтение и запись к каталогу,
который хранит файл сокета, или соответствующую привилегию на доступ к файлу.
В этом случае Вы должны изменить привилегию для каталога (файла) или
перезапустить <CODE>mysqld</CODE> так, чтобы он использовал каталог, к
которому Вы можете обращаться.</UL>

<P>Если Вы получаете сообщение об ошибке <CODE>Can't connect to MySQL server
on some_hostname</CODE>, Вы можете попробовать следующие вещи, чтобы
выяснить, какова проблема:</P>

<UL><LI>Проверьте работоспособность сервера командой <CODE>telnet
your-host-name tcp-ip-port-number</CODE> с двойным нажатием
<CODE>RETURN</CODE>. Если имеется сервер MySQL, слушающий на этом порте, Вы
должны получить ответ, который включает номер версии. Если Вы получаете
ошибку подобно <CODE>telnet: Unable to connect to remote host: Connection
refused</CODE>, стало быть там не имеется никакого сервера. Куда он делся?
Это уже другой вопрос, ищите...

<LI>Попробуйте соединиться с <CODE>mysqld</CODE> на локальной машине и
проверить TCP/IP порт, на который <CODE>mysqld</CODE> сконфигурирован
(переменная <CODE>port</CODE>) с помощью <CODE>mysqladmin variables</CODE>.

<LI>Проверьте, что сервер <CODE>mysqld</CODE> не запущен с параметром
<CODE>--skip-networking</CODE>.</UL>

<H3><A NAME="Blocked_host">11.2.4 Ошибка <CODE>Host '...' is blocked</CODE>
</A></H3>
<P>Если Вы получаете сообщение об ошибке:</P>
<PRE>
Host 'hostname' is blocked because of many connection errors.
Unblock with 'mysqladmin flush-hosts'
</PRE>

<P>Это означает, что <CODE>mysqld</CODE> получил много
(<CODE>max_connect_errors</CODE>) запросов подключения с компьютера
<CODE>hostname</CODE>, которые были прерваны в середине. После
<CODE>max_connect_errors</CODE> потерпевших неудачу запросов
<CODE>mysqld</CODE> считает, что что-то неправильно (подобно нападению
хакеров) и блокирует дальнейшие соединения с этой машины, пока кто-то не
выполняет команду <CODE>mysqladmin flush-hosts</CODE>.</P>

<P>По умолчанию <CODE>mysqld</CODE> блокирует компьютер после 10 ошибок
подключения. Вы можете легко корректировать это, запуская сервер так:</P>
<PRE>
shell&#62; safe_mysqld -O max_connect_errors=10000 &#38;
</PRE>

<P>Обратите внимание, что, если Вы получаете это сообщение об ошибках для
данного компьютера, Вы должны сначала проверить, что не имеется чего-нибудь
неправильного с TCP/IP подключениями. Если Ваши TCP/IP подключения не
работают, увеличение переменной <CODE>max_connect_errors</CODE> не поможет!
</P>

<H3><A NAME="Too_many_connections">11.2.5 Ошибка <CODE>Too many connections
</CODE></A></H3>
<P>Если Вы получаете ошибку <CODE>Too many connections</CODE>, когда Вы
пробуете соединиться с MySQL, это означает, что уже имеется
<CODE>max_connections</CODE> клиентов, работающих с сервером.</P>

<P>Если Вы нуждаетесь в большем количестве подключений, чем значение по
умолчанию (100), то перезапустите <CODE>mysqld</CODE> с большим значением для
переменной <CODE>max_connections</CODE>.</P>

<P>Обратите внимание, что <CODE>mysqld</CODE> фактически позволяет
(<CODE>max_connections</CODE>+1) подключений. Последнее подключение
зарезервировано для пользователя с привилегией <STRONG>process</STRONG>.
Не давая эту привилегию нормальным пользователям (они не должны нуждаться в
ней), администратор с этой привилегией может войти и использовать
<CODE>SHOW PROCESSLIST</CODE>, чтобы выяснить то, что могло бы быть
неправильно. Подробности приведены в разделе "<A HREF="glava04.htm#SHOW">
4.10 Синтаксис команды <CODE>SHOW</CODE></A>".</P>

<P>Максимальное количество подключений зависит от того, как хороша библиотека
потоков на данной платформе. Linux или Solaris могут поддерживать 500-1000
одновременных подключений в зависимости от того, сколько RAM Вы имеете, и
что Ваша клиентура делает.</P>

<H3><A NAME="Non-transactional_tables">11.2.6
Ошибка <CODE>Some non-transactional changed tables couldn't be rolled back
</CODE></A></H3>
<P>Если Вы получаете ошибку <CODE>Warning: Some non-transactional changed
tables couldn't be rolled back</CODE> при попытке сделать
<CODE>ROLLBACK</CODE>, это означает, что некоторые из таблиц, которые Вы
использовали, не поддерживали транзакции. На эти таблицы не будет
воздействовать инструкция <CODE>ROLLBACK</CODE>.</P>

<P>Наиболее типичный случай, когда это случается: когда Вы пробовали
создавать таблицу типа, который не поддержан Вашей версией
<CODE>mysqld</CODE>. Если <CODE>mysqld</CODE> не поддерживает тип таблицы
(или если тип таблицы заблокирован опцией запуска), он взамен создаст таблицу
такого типа, который больше всего подходит к тому, который Вы запросили,
вероятно, это будет <CODE>MyISAM</CODE>.</P>

<P>Вы можете проверять тип таблицы:
<PRE>
SHOW TABLE STATUS LIKE 'table_name'</CODE>.
</PRE>

Подробности в разделе "<A HREF="glava04.htm#SHOW_TABLE_STATUS">4.10.2
<CODE>SHOW TABLE STATUS</CODE></A>".</P>

<P>Вы можете проверять, какие расширения поддерживает Ваша версия
<CODE>mysqld</CODE> следующей командой:</P>

<P><CODE>show variables like 'have_%'</CODE>. Подробности в разделе
"<A HREF="glava04.htm#SHOW_VARIABLES">4.10.4 <CODE>SHOW VARIABLES</CODE>
</A>".</P>

<H3><A NAME="Out_of_memory">11.2.7 Ошибка <CODE>Out of memory</CODE></A></H3>
<P>Если Вы выдаете запрос и получаете нечто вроде следующей ошибки:</P>
<PRE>
mysql: Out of memory at line 42, 'malloc.c'
mysql: needed 8136 byte (8k), memory in use: 12481367 bytes (12189k)
ERROR 2008: MySQL client ran out of memory
</PRE>

<P>Обратите внимание, что ошибка относится к клиенту <CODE>mysql</CODE>.
Причина для этой ошибки: клиент не имеет достаточно памяти, чтобы сохранить
целиком полученный результат.</P>

<P>Чтобы выправить проблему, сначала проверьте, что Ваш запрос правилен.
Является ли приемлемым, чтобы он возвратил так много строк? Если да, Вы
можете использовать <CODE>mysql --quick</CODE>, который использует
<CODE>mysql_use_result()</CODE>, чтобы получить набор результатов. Это
помещает меньшее количество нагрузки на клиента (но больше на сервер).</P>

<H3><A NAME="Packet_too_large">11.2.8 Ошибка <CODE>Packet too large</CODE>
</A></H3>
<P>Когда клиент MySQL или сервер <CODE>mysqld</CODE> получает пакет больше,
чем <CODE>max_allowed_packet</CODE> байт, он выдает ошибку <CODE>Packet too
large</CODE> и закрывает подключение.</P>

<P>Если Вы используете клиента <CODE>mysql</CODE>, Вы можете определять
больший буфер, запуская клиента командой
<CODE>mysql --set-variable=max_allowed_packet=8M</CODE>.</P>

<P>Если Вы используете другую клиентуру, которая не позволяет Вам определять
максимальный размер пакета (типа <CODE>DBI</CODE>), Вы должны установить
размер пакета, когда Вы запускаете сервер. Вы используете опцию командной
строки для <CODE>mysqld</CODE>, чтобы установить
<CODE>max_allowed_packet</CODE> к большему размеру. Например, если Вы
ожидаете сохранять полную длину <CODE>BLOB</CODE> в таблицу, Вы будете должны
запустить сервер с опцией <CODE>--set-variable=max_allowed_packet=16M</CODE>.
</P>

<P>Вы можете также получать странные проблемы с большими пакетами, если Вы
используете большие blob'ы, но не дали <CODE>mysqld</CODE> доступ к
достаточной памяти, чтобы обработать запрос. Если Вы подозреваете, что дело
обстоит именно так, попробуйте добавить <CODE>ulimit -d 256000</CODE> к
скрипту <CODE>safe_mysqld</CODE> и перезапустить <CODE>mysqld</CODE>.</P>

<H3><A NAME="Communication_errors">11.2.9
Ошибки связи и прерванные подключения</A></H3>
<P>Начиная с <CODE>MySQL 3.23.40</CODE> Вы получаете только ошибку
<CODE>Aborted connection</CODE> при запуске <CODE>mysqld</CODE> с опцией
<CODE>--warnings</CODE>.</P>

<P>Если Вы находите ошибки, подобные следующей, в Вашем файле регистрации:
</P>
<PRE>
010301 14:38:23  Aborted connection 854 to db: 'users' user: 'josh'
</PRE>

<P>Это означает, что что-то из следующего случилось:</P>
<UL><LI>Программа пользователя не вызвала <CODE>mysql_close()</CODE> перед
выходом.
<LI>Пользователь бездействовал больше, чем <CODE>wait_timeout</CODE> или
<CODE>interactive_timeout</CODE> без того, чтобы делать любые запросы.
<LI>Программа пользователя была закончена резко в середине передачи.</UL>

<P>Когда вышеупомянутое случается, переменная сервера
<CODE>Aborted_clients</CODE> будет увеличена.</P>

<P>Переменная сервера <CODE>Aborted_connects</CODE> растет:</P>
<UL><LI>Когда пакет подключения не содержит правильную информацию.
<LI>Когда пользователь не имел привилегии, чтобы соединиться с базой данных.
<LI>Когда пользователь указывает неправильный пароль.
<LI>Когда требуется больше, чем <CODE>connect_timeout</CODE> секунд, чтобы
получить подключенный пакет.</UL>

<P>Обратите внимание, что вышеупомянутое может указывать, что кто-то пробует
врываться в Вашу базу данных!</P>

<P>Другие причины для проблем с клиентами и прерванными подключениями.
<UL><LI>Использование дуплексного протокола Ethernet в половинном и полном
режимах с Linux. Многие драйверы Ethernet для Linux имеют эту ошибку. Вы
должны проверить ее наличие, пересылая огромный файл через ftp между двумя
машинами. Если передача входит в режим "burst-pause-burst-pause ...", значит
Вы испытываете дуплексный синдром Linux. Единственное решение для этой
проблемы: правильно настроить драйвер.
<LI>Некоторые проблемы с библиотекой потоков, которая вызывает прерывания на
разных вызовах чтения.
<LI>Неправильно настроен протокол TCP/IP.
<LI>Где-то накрылась сеть: кабель, коммутатор, концентратор...
<LI><CODE>max_allowed_packet</CODE> слишком маленький, или запросы требуют
большее количество памяти, чем Вы имеете для <CODE>mysqld</CODE>.</UL>

<H3><A NAME="Full_table">11.2.10 Ошибка <CODE>The table is full</CODE></A>
</H3>
<P>Эта ошибка происходит в старых версиях MySQL, когда расположенная в памяти
временная таблица становится больше, чем <CODE>tmp_table_size</CODE> байт.
Чтобы избежать этой проблемы, Вы можете использовать опцию <CODE>-O
tmp_table_size=#</CODE>, чтобы увеличить размер временной таблицы или
использовать опцию <CODE>SQL_BIG_TABLES</CODE> прежде, чем Вы выдаете
проблематичный запрос.</P>

<P>Вы можете также запустить <CODE>mysqld</CODE> с опцией
<CODE>--big-tables</CODE>. Это действует точно также, как использование для
всех запросов <CODE>SQL_BIG_TABLES</CODE>.</P>

<P>В MySQL Version 3.23 временная таблица в памяти будет автоматически
преобразована в дисковую <CODE>MyISAM</CODE> после того, как размер таблицы
станет больше, чем <CODE>tmp_table_size</CODE>.</P>

<H3><A NAME="Cannot_create">11.2.11 Ошибка <CODE>Can't create/write to file
</CODE></A></H3>
<P>Если для некоторых запросов Вы получаете ошибку типа:
<PRE>
Can't create/write to file '\\sqla3fe_0.ism'.
</PRE></P>

<P>Это означает, что MySQL не может создать временный файл для набора
результатов в заданном временном каталоге. Для исправления запустите
<CODE>mysqld</CODE> с опцией <CODE>--tmpdir=path</CODE> или добавьте к файлу
опцией сервера следующее:</P>
<PRE>
[mysqld]
tmpdir=C:/temp
</PRE>

<P>Считается, что каталог <TT>c:\temp</TT> существует.</P>

<P>Проверьте также код ошибки, который Вы получаете через
<CODE>perror</CODE>. Причиной может быть также полный диск;</P>
<PRE>
shell&#62; perror 28
Error code 28: No space left on device
</PRE>

<H3><A NAME="Commands_out_of_sync">11.2.12 Ошибка на клиенте
<CODE>Commands out of sync</CODE></A></H3>
<P>Если Вы получаете <CODE>Commands out of sync; You can't run this command
now</CODE> в Вашем коде пользователя, стало быть Вы вызываете функции
пользователя в неправильном порядке!</P>

<P>Это может случаться, например, если Вы используете
<CODE>mysql_use_result()</CODE> и пробуете выполнять новый запрос прежде, чем
Вы вызвали <CODE>mysql_free_result()</CODE>. Это может также случаться, если
Вы пробуете выполнять два запроса, которые возвращают данные, без
обязательного вызова функции <CODE>mysql_use_result()</CODE> или
<CODE>mysql_store_result()</CODE> между ними.</P>

<H3><A NAME="Ignoring_user">11.2.13 Ошибка <CODE>Ignoring user</CODE></A>
</H3>
<P>Если Вы получаете следующую ошибку:</P>
<PRE>
Found wrong password for user: 'some_user@some_host'; Ignoring user
</PRE>

<P>Это означает, что, когда <CODE>mysqld</CODE> запустился или перезагрузил
таблицы привилегий, он нашел запись в таблице <CODE>user</CODE> с
недопустимым паролем. В результате запись просто игнорируется системой.</P>

<P>Возможные причины для этой проблемы:</P>
<UL><LI>Вы можете управлять новой версией <CODE>mysqld</CODE> со старой
таблицей <CODE>user</CODE>. Вы можете проверить это, выполняя <CODE>mysqlshow
mysql user</CODE>, чтобы видеть, является ли поле пароля короче, чем 16
символов. Если это так, Вы можете исправлять это дело запуском скрипта
<CODE>scripts/add_long_password</CODE>.

<LI>Пользователь имеет старый пароль (длиной 8 символов), и Вы не запускали
<CODE>mysqld</CODE> с опцией <CODE>--old-protocol</CODE>. Модифицируйте
пользователя в таблице <CODE>user</CODE> с новым паролем или перезапустите
<CODE>mysqld</CODE> с опцией <CODE>--old-protocol</CODE>.

<LI><A NAME="IDX1659"></A>Вы определили пароль в таблице <CODE>user</CODE>
без того, чтобы использовать функцию <CODE>PASSWORD()</CODE>. Примените
<CODE>mysql</CODE>, чтобы модифицировать пользователя в таблице
<CODE>user</CODE> с новым паролем. Удостоверьтесь, что вызвана функция
<CODE>PASSWORD()</CODE>:
<PRE>
mysql&#62; update user set password=PASSWORD('your password')
                       where user='XXX';
</PRE></UL>

<H3><A NAME="Cannot_find_table">11.2.14
Ошибка <CODE>Table 'xxx' doesn't exist</CODE></A></H3>
<P>Если Вы получаете ошибку <CODE>Table 'xxx' doesn't exist</CODE> или
<CODE>Can't find file: 'xxx' (errno: 2)</CODE>, это означает, что таблица с
именем <CODE>xxx</CODE> не существует в текущей (актуальной) базе данных.</P>

<P>Обратите внимание, что MySQL использует каталоги и файлы, чтобы сохранить
базы данных и таблицы, так что имена баз данных и таблиц чувствительны к
регистру! В Windows это не так, но все ссылки к данной таблице внутри запроса
должны использовать тот же самый регистр.</P>

<P>Вы можете проверить, какие таблицы Вы имеете в текущей базе данных, через
<CODE>SHOW TABLES</CODE>. Подробности в разделе "<A HREF="glava04.htm#SHOW">
4.10 Синтаксис <CODE>SHOW</CODE></A>".</P>

<H3><A NAME="Cannot_initialize_character_set">11.2.15
Ошибка <CODE>Can't initialize character set xxx</CODE></A></H3>
<P>Если Вы получаете ошибку подобно:</P>
<PRE>
MySQL Connection Failed: Can't initialize character set xxx
</PRE>

<P>Это означает одно из следующего:</P>
<UL><LI>Набор символов многобайтный, а Вы не имеете поддержки для него на
клиенте. В этом случае Вы должны перетранслировать клиента с опцией
<CODE>--with-charset=xxx</CODE> или <CODE>--with-extra-charsets=xxx</CODE>.
Все стандартные двоичные файлы MySQL компилируются с
<CODE>--with-extra-character-sets=complex</CODE>, что допускает поддержку для
всех многобайтных наборов символов.

<LI>Набор символов простой, но тот, который не компилируется в
<CODE>mysqld</CODE>, и файлы определения набора символов не в том месте, где
клиент ожидает находить их. В этом случае Вы должны:

<UL><LI>Перетранслируйте клиента с поддержкой для набора символов.
<LI>Определите, где искать файлы определения набора символов. Для многих
клиентов это делается через опцию
<CODE>--character-sets-dir=path-to-charset-dir</CODE>.

<LI>Копируйте символьные файлы определения туда, где их ищет клиент.</UL>
</UL>

<H3><A NAME="Not_enough_file_handles">11.2.16 Файл не найден</A></H3>
<P>Если Вы получаете <CODE>ERROR '...' not found (errno: 23)</CODE>,
<CODE>Can't open file: ... (errno: 24)</CODE> или любую другую ошибку с
<CODE>errno 23</CODE> или <CODE>errno 24</CODE> из MySQL, это означает, что
Вы не распределили достаточно описателей файла для MySQL. Вы можете
использовать утилитку <CODE>perror</CODE>, чтобы получить описание того, что
код ошибки означает:</P>

<PRE>
shell&#62; perror 23
File table overflow
shell&#62; perror 24
Too many open files
shell&#62; perror 11
Resource temporarily unavailable
</PRE>

<P>Проблема здесь состоит в том, что <CODE>mysqld</CODE> пробует хранить
открытыми слишком много файлов одновременно. Вы можете сообщать, чтобы
<CODE>mysqld</CODE> не открывал так много файлов сразу, или увеличить число
описателей файла, доступных для <CODE>mysqld</CODE>.</P>

<P>Чтобы сообщать, чтобы <CODE>mysqld</CODE> хранил открытым меньшее
количество файлов одновременно, Вы можете сделать кэш таблицы меньшим,
используя опцию <CODE>-O table_cache=32</CODE> при вызове
<CODE>safe_mysqld</CODE> (значение по умолчанию 64). Уменьшение значения
<CODE>max_connections</CODE> также уменьшит число открытых файлов (значение
по умолчанию: 90).</P>

<P><A NAME="IDX1661"></A>Чтобы изменять число описателей файла, доступных
<CODE>mysqld</CODE>, Вы можете использовать опцию
<CODE>--open-files-limit=#</CODE> при вызове <CODE>safe_mysqld</CODE> или
<CODE>-O open-files-limit=#</CODE> при запуске <CODE>mysqld</CODE>. Самый
простой способ сделать это состоит в том, чтобы добавить опцию к Вашему
файлу опции. Если Вы имеете старую версию <CODE>mysqld</CODE>, которая не
поддерживает это, Вы можете отредактировать скрипт <CODE>safe_mysqld</CODE>.
Имеется прокомментированная строка <CODE>ulimit -n 256</CODE> в скрипте. Вы
можете удалять символ <CODE>#</CODE>, чтобы раскомментировать строку и
изменить число 256, чтобы воздействовать на число описателей файла.</P>

<P><CODE>ulimit</CODE> (и <CODE>open-files-limit</CODE>) может увеличивать
число описателей файла, но только до ограничения, наложенного операционной
системой. Имеется также жесткое ограничение, которое может быть перекрыто
только, если Вы запускаете <CODE>safe_mysqld</CODE> или <CODE>mysqld</CODE>
как root (только не забудьте, что Вы должны также использовать опцию
<CODE>--user=..</CODE> в этом случае). Если Вы должны увеличить ограничение
OS на число описателей файла, доступных каждому процессу, консультируйтесь с
документацией для Вашей операционной системы.</P>

<P>Обратите внимание, что, если Вы выполняете оболочку <CODE>tcsh</CODE>,
<CODE>ulimit</CODE> не будет работать! <CODE>tcsh</CODE> также сообщит
неправильные значения, когда Вы спросите о текущих ограничениях. В этом
случае Вы должны запустить <CODE>safe_mysqld</CODE> из <CODE>sh</CODE>.</P>

<H2><A NAME="Installation_Issues">11.3 Проблемы при установке</A></H2>
<H3><A NAME="Link_errors">11.3.1 Проблемы компоновки с библиотекой
клиентов MySQL</A></H3>
<P>Если Вы компонуете Вашу программу и получаете ошибки для невызванных
символов, которые начинаются с <CODE>mysql_</CODE>, подобно следующему:</P>
<PRE>
/tmp/ccFKsdPa.o: In function `main':
/tmp/ccFKsdPa.o(.text+0xb): undefined reference to `mysql_init'
/tmp/ccFKsdPa.o(.text+0x31): undefined reference to `mysql_real_connect'
/tmp/ccFKsdPa.o(.text+0x57): undefined reference to `mysql_real_connect'
/tmp/ccFKsdPa.o(.text+0x69): undefined reference to `mysql_error'
/tmp/ccFKsdPa.o(.text+0x9a): undefined reference to `mysql_close'
</PRE>

<P>Вы должны быть способны решить это, добавляя
<CODE>-Lpath-to-the-mysql-library -lmysqlclient</CODE> <STRONG>В САМОМ КОНЦЕ
</STRONG> строки для компоновщика.</P>

<P>Если Вы получаете ошибки <CODE>undefined reference</CODE> для функций
<CODE>uncompress</CODE> или <CODE>compress</CODE>, добавьте <CODE>-lz</CODE>
<STRONG>В САМОМ КОНЦЕ </STRONG> строки для компоновщика.</P>

<P>Если Вы получаете ошибки <CODE>undefined reference</CODE> для функций,
которые должны существовать в Вашей системе, подобно <CODE>connect</CODE>,
проверьте man-страницу для рассматриваемой функции, чтобы выяснить, какую
библиотеку Вы должны добавить.</P>

<P>Если Вы получаете ошибки <CODE>undefined reference</CODE> для функций,
которые не существуют в Вашей системе, подобно следующему:</P>
<PRE>
mf_format.o(.text+0x201): undefined reference to `__lxstat'
</PRE>

<P>Это обычно означает, что библиотека компилируется на системе, которая не
на 100%, совместима с Вашей. В этом случае Вы должны загрузить последний
исходник MySQL и откомпилировать библиотеку непосредственно.</P>

<P>Если Вы пробуете выполнять программу и получаете ошибки для невызванных
символов, которые начинаются с <CODE>mysql_</CODE>, или о том, что библиотека
<CODE>mysqlclient</CODE> не может быть найдена, это означает, что Ваша
система не может найти общую библиотеку <CODE>libmysqlclient.so</CODE>.</P>

<UL><LI>Добавьте путь к каталогу, где Вы имеете
<CODE>libmysqlclient.so</CODE>, к системной переменной
<CODE>LD_LIBRARY_PATH</CODE>.

<LI>Добавьте путь к каталогу, где Вы имеете
<CODE>libmysqlclient.so</CODE>, к системной переменной
<CODE>LD_LIBRARY</CODE>.

<LI>Копируйте <CODE>libmysqlclient.so</CODE> в место, где система ищет общие
библиотеки, например, <TT>/lib</TT>, и модифицируйте общедоступную
библиотечную информацию, выполняя <CODE>ldconfig</CODE>.</UL>

<P>Другой способ решать эту проблему состоит в том, чтобы скомпоновать Вашу
программу статически с опцией <CODE>-static</CODE> или удалить динамические
библиотеки MySQL перед компоновкой Вашего кода. Во втором случае Вы должны
убедиться, что никакие другие программы не используют динамические библиотеки!
</P>

<H3><A NAME="Changing_MySQL_user">11.3.2 Как запустить MySQL от
имени нормального пользователя</A></H3>
<P>MySQL-сервер <CODE>mysqld</CODE> может быть запущен и выполняться любым
пользователем. Чтобы <CODE>mysqld</CODE> работал как Unix-пользователь
<CODE>user_name</CODE>, Вы должны сделать следующие шаги:</P>

<OL><LI>Завершите сервер, если он запущен (<CODE>mysqladmin shutdown</CODE>).
<LI>Измените каталоги баз данных и файлы так, чтобы <CODE>user_name</CODE>
имел права на чтение и запись:
<PRE>
shell&#62; chown -R user_name /path/to/mysql/datadir
</PRE>

Если каталоги или файлы внутри каталога данных MySQL представляют собой
символические ссылки, Вы будете также должны следовать за теми связями и
изменять каталоги и файлы, на которые они указывают. Увы,
<CODE>chown -R</CODE> не может следовать за ссылками для Вас.

<LI>Запустите сервер как пользователь <CODE>user_name</CODE> или, если Вы
используете MySQL Version 3.22 или позже, как Unix-пользователь
<CODE>root</CODE> с опцией <CODE>--user=user_name</CODE>.
<CODE>mysqld</CODE> переключится на Unix-пользователя <CODE>user_name</CODE>
перед принятием любых подключений.

<LI>Чтобы запустить сервер как данное имя пользователя автоматически при
запуске системы, добавьте строку <CODE>user</CODE>, которая определяет имя
пользователя, к группе <CODE>[mysqld]</CODE> файла <TT>/etc/my.cnf</TT> (или
<TT>my.cnf</TT>) в каталоге данных сервера. Например:
<PRE>
[mysqld]
user=user_name
</PRE>
</OL>

<P>Обратите внимание, что доступ к MySQL как <CODE>root</CODE> указанием
<CODE>-u root</CODE> в командной строке, не имеет <EM>никакого</EM> отношения
к запуску MySQL как <CODE>root</CODE>. Права доступа и имена пользователей
MySQL полностью независимы от имен в Unix. Единственное подключение с именем
пользователя Unix происходит, если Вы не указали опцию <CODE>-u</CODE>, когда
Вы вызываете программу пользователя. Клиент пробует подключиться, используя
Ваше Unix-имя входа в систему как имя пользователя MySQL.</P>

<H3><A NAME="File_permissions">11.3.3 Проблемы с доступом к файлам</A></H3>
<P>Если Вы имеете проблемы с правами доступа к файлам, например, если
<CODE>mysql</CODE> выдает такое сообщение об ошибке, когда создаете таблицу:
</P>
<PRE>
ERROR: Can't find file: 'path/with/filename.frm' (Errcode: 13)
</PRE>

<P><A NAME="IDX1670"></A><A NAME="IDX1671"></A>То системная переменная
<CODE>UMASK</CODE> может быть установлена неправильно, когда запускается
<CODE>mysqld</CODE>. Значение по умолчанию для umask: <CODE>0660</CODE>.
Вы можете изменять это поведение, запуская <CODE>safe_mysqld</CODE> так:</P>
<PRE>
shell&#62; UMASK=384  # = 600 in octal
shell&#62; export UMASK
shell&#62; /path/to/safe_mysqld &#38;
</PRE>

<P><A NAME="IDX1672"></A><A NAME="IDX1673"></A>По умолчанию MySQL создаст
базу данных и каталоги <CODE>RAID</CODE> с правами доступа 0700. Вы можете
изменять это поведение, устанавливая переменную <CODE>UMASK_DIR</CODE>.
Если Вы устанавливаете ее, новые каталоги будут созданы с объединением
<CODE>UMASK</CODE> и <CODE>UMASK_DIR</CODE>. Например, если Вы хотите давать
группе доступ ко всем новым каталогам, Вы можете сделать:</P>
<PRE>
shell&#62; UMASK_DIR=504              # =770 в аосьмеричном формате.
shell&#62; export UMASK_DIR
shell&#62; /path/to/safe_mysqld &#38;
</PRE>

<P>В MySQL Version 3.23.25 и выше MySQL считает, что значения
<CODE>UMASK</CODE> и <CODE>UMASK_DIR</CODE> заданы в восьмеричном формате,
если они начинаются с ноля.</P>

<H2><A NAME="Administration_Issues">11.4
Проблемы, связанные с администрированием</A></H2>

<H3><A NAME="Crashing">11.4.1 Что делать, если MySQL падает</A></H3>
<P>Все версии MySQL проверены на многих платформах прежде, чем они выпущены.
Это не означает, что не имеется любых ошибок в MySQL, но это означает, что их
там очень мало.</P>

<P>Сначала Вы должны пробовать выяснять, состоит ли проблема в том, что
<CODE>mysqld</CODE> падает, или ее корень надо искать на клиенте. Вы можете
проверять время работы сервера <CODE>mysqld</CODE> командой <CODE>mysqladmin
version</CODE>. Если <CODE>mysqld</CODE> свалился, Вы можете находить причину
этого в файле <TT>mysql-data-directory/hostname.err</TT>.</P>

<P>Много сбоев MySQL вызваны разрушенным индексом или файлами данных. MySQL
модифицирует данные относительно диска через системный вызов
<CODE>write()</CODE> после каждой инструкции SQL, но прежде, чем пользователю
сообщают относительно результата. Это не так, если Вы работаете с опцией
<CODE>delayed_key_writes</CODE>, когда только данные будут записаны. Это
означает, что данные в безопасности, даже если сбоит <CODE>mysqld</CODE>,
если ОС гарантируют, что данные будут сброшены из кэша на диск. Вы можете
заставить MySQL сбрасывать кэш принудительно после каждой команды SQL,
запуская <CODE>mysqld</CODE> с опцией <CODE>--flush</CODE>.</P>

<P>Вышеупомянутое означает, что обычно Вы не должны получить разрушенные
таблицы и файлы, если:</P>

<UL><LI>Кто-то уничтожил <CODE>mysqld</CODE> в середине модификации.
<LI>Вы нашли неизвестную ошибку в <CODE>mysqld</CODE>, которая разрушила его
в середине модификации.
<LI>Кто-то управляет файлами данных или индекса вне <STRONG>mysqld</STRONG>
без того, чтобы блокировать таблицу.
<LI>Если Вы управляете несколькими серверами <CODE>mysqld</CODE> на тех же
самых данных в системе, которая не поддерживает хорошие блокировки файловой
системы (обычно обрабатываемые сервером <CODE>lockd</CODE>), или была указана
опция <CODE>--skip-locking</CODE> при запуске сервера.
<LI>Вы имеете поврежденный файл индекса или данных, который содержит очень
неправильные данные, в результате <CODE>mysqld</CODE> запутался.
<LI>Вы нашли ошибку в коде памяти. Это не очень вероятно, но это по крайней
мере возможно. В этом случае Вы можете пробовать изменять файл к другому
драйверу базы данных использованием <CODE>ALTER TABLE</CODE> на
восстановленной копии таблицы.</UL>

<P>Поскольку очень трудно узнать, почему что-то терпит крах, сначала
попробуйте проверить следующее:</P>

<UL><LI>Завершите <CODE>mysqld</CODE> с помощью <CODE>mysqladmin
shutdown</CODE>, запустите <CODE>myisamchk --silent --force */*.MYI</CODE> на
всех таблицах и перезапустите сервер <CODE>mysqld</CODE>. Это гарантирует,
что Вы запустились с чистого состояния.

<LI>Используйте <CODE>mysqld --log</CODE> и попробуйте определить из
информации в файле регистрации, уничтожает или нет некоторый специфический
запрос сервер. Приблизительно 95% всех ошибок связаны со специфическим
запросом! Обычно это один из последних запросов в журнале. Если Вы можете
повторить процесс уничтожения MySQL одним из запросов даже, когда Вы проверили
все таблицы перед выполнением запроса, то ошибка локализована. Готовьте отчет
об ошибке. Подробности в разделе "<A HREF="appl3.htm#Bug_reports">Приложение
3. Как сообщать о проблемах и сбоях</A>".

<LI>Попробуйте управлять включенным тестом mysql-test и эталонными тестами
MySQL. Подробности в разделе "<A HREF="glava14.htm#MySQL_test_suite">14.3.2
Набор тестов MySQL</A>". Они должны проверить MySQL довольно хорошо. Вы
можете также добавлять к эталонным тестам код, который моделирует Вашу
прикладную программу. Эталонные тесты могут быть найдены в каталоге
<TT>bench</TT> дистрибутива исходного кода или, для двоичных дистрибутивов, в
каталоге <TT>sql-bench</TT> под Вашим каталогом установок MySQL.

<LI>Попробуйте выполнить <CODE>fork_test.pl</CODE> и
<CODE>fork2_test.pl</CODE>.

<LI>Вы применили самые последние заплатки для Вашей операционной системы?

<LI>Используйте опцию <CODE>--skip-locking</CODE> для <CODE>mysqld</CODE>.
На некоторых системах администратор блокировок <CODE>lockd</CODE> не работает
правильно. Опция <CODE>--skip-locking</CODE> сообщает, чтобы
<CODE>mysqld</CODE> не использовал внешнюю блокировку. Это означает, что Вы
не сможете выполнять несколько серверов <CODE>mysqld</CODE> на тех же самых
данных, и что Вы должны быть внимательны, если Вы используете
<CODE>myisamchk</CODE>, но может быть поучительно опробовать опцию как тест.

<LI>Вы пробовали <CODE>mysqladmin -u root processlist</CODE>, когда
<CODE>mysqld</CODE> работает, но не отвечает? Иногда <CODE>mysqld</CODE> не
завис даже при том, что Вы могли бы думать именно так. Проблема может
состоять в том, что все подключения находятся в использовании, или может
иметься некоторая внутренняя проблема блокировки. Вызов <CODE>mysqladmin
processlist</CODE> обычно будет способен делать подключение даже в этих
случаях и может обеспечивать полезную информацию относительно текущего числа
подключений и их состояния.

<LI>Выполните команду <CODE>mysqladmin -i 5 status</CODE> или
<CODE>mysqladmin -i 5 -r status</CODE>, чтобы произвести статистику в то
время, как Вы выполняете другие Ваши запросы.

<LI>Попытайтесь смоделировать Вашу прикладную программу скриптом на Perl,
чтобы вынудить MySQL разрушаться или плохо себя вести.

<LI>Пошлите нормальный отчет об ошибке. Подробности в разделе
"<A HREF="appl3.htm#Bug_reports">Как сообщать о проблемах и сбоях</A>". Может
быть аварийный отказ следует из чего-то такого, что существует только на
Вашем компьютере (например, ошибка, которая связана с Вашими
специфическими библиотеками системы).

<LI>Если Вы имеете проблему с таблицами со строками динамической длины, и Вы
не используете столбцы <CODE>BLOB/TEXT</CODE> (только <CODE>VARCHAR</CODE>),
Вы можете пробовать изменять все <CODE>VARCHAR</CODE> на <CODE>CHAR</CODE> с
помощью команды <CODE>ALTER TABLE</CODE>. Это вынудит MySQL использовать
строки фиксированных размеров. Они берут небольшое дополнительное
пространство, но намного более терпимы к искажению! Текущий динамический код
строки был в использовании в MySQL AB по крайней мере 3 года без всяких
проблем, но строки динамической длины вообще более склонны к ошибкам, так что
посмотрите, что получится.</UL>

<H3><A NAME="Resetting_permissions">11.4.2 Как сбрасывать забытый пароль</A>
</H3>
<P>Если Вы забыли пароль пользователя <CODE>root</CODE> для MySQL, Вы можете
восстанавливать его следующей процедурой:</P>

<OL><LI>Завершите сервер <CODE>mysqld</CODE> отправкой ему команды
<CODE>kill</CODE> (но не <CODE>kill -9</CODE>!). Идентификатор процесса будет
сохранен в <CODE>.pid</CODE>-файле, который обычно хранится в каталоге для
баз данных MySQL:
<PRE>
kill `cat /mysql-data-directory/hostname.pid`
</PRE>

Вы должны быть Unix-пользователем <CODE>root</CODE> или тем пользователем, от
имени которого выполняется сервер.

<LI>Перезапустите <CODE>mysqld</CODE> с опцией
<CODE>--skip-grant-tables</CODE>.

<LI>Соединитесь с <CODE>mysqld</CODE> командой <CODE>mysql -h hostname
mysql</CODE> и смените пароль командой <CODE>GRANT</CODE>. Подробности в
разделе "<A HREF="glava10.htm#GRANT">10.1 Синтаксис <CODE>GRANT</CODE> и
<CODE>REVOKE</CODE></A>". Вы можете также делать это с помощью команды
<CODE>mysqladmin -h hostname -u user password new_password</CODE>.

<LI>Загрузите таблицы предоставления привилегий: <CODE>mysqladmin -h hostname
flush-privileges</CODE> или командой SQL <CODE>FLUSH PRIVILEGES</CODE>.</OL>

<P>Обратите внимание, что после того, как Вы запустили <CODE>mysqld</CODE> с
опцией <CODE>--skip-grant-tables</CODE>, любое использование команды
<CODE>GRANT</CODE> даст Вам ошибку <CODE>Unknown command</CODE>, пока Вы не
выполните <CODE>FLUSH PRIVILEGES</CODE>.</P>

<H3><A NAME="Full_disk">11.4.3 Как MySQL обрабатывает полный диск</A></H3>
<P>Когда диск полностью заполнится, MySQL делает следующее:</P>

<UL><LI>Он проверяет раз в минуту, чтобы видеть, имеется или нет достаточно
места, чтобы записать текущую строку. Если имеется достаточно места на диске,
работа продолжается, как будто ничто не случилось.

<LI>Каждые 5-6 минут в журнал пишется предупреждение о полном диске.</UL>

<P>Чтобы облегчить проблему, Вы можете предпринять следующие действия:</P>
<UL><LI>Чтобы продолжать работу, Вы должны только освободить достаточно
места, чтобы вставить все записи.

<LI>Чтобы прервать поток, пошлите <CODE>mysqladmin kill</CODE> потоку. Он
будет прерван, когда в следующий раз проверит диск (через минуту).

<LI>Обратите внимание, что другие потоки могут ждать таблицу, которая вызвала
переполнение диска. Если Вы имеете несколько блокированных потоков,
уничтожение того, который переполнил диск, позволит другим продолжаться.</UL>

<P>Исключительные ситуации: Вы используете <CODE>REPAIR</CODE> или
<CODE>OPTIMIZE</CODE>, индексы созданы в пакете после <CODE>LOAD DATA
INFILE</CODE>, или выполнена инструкция <CODE>ALTER TABLE</CODE>.</P>

<P>Все вышеприведенные команды могут использовать большие временные файлы,
которые остались после них на диске, что вызовет большие проблемы для
остальной части системы. Если MySQL переполняет диск при выполнении любой из
вышеупомянутых операций, он удалит большие временные файлы и отметит таблицу
как поврежденную (исключение: <CODE>ALTER TABLE</CODE>, в этом случае старая
таблица будет оставлена неизменной).</P>

<H3><A NAME="Temporary_files">11.4.4 Где MySQL хранит временные файлы</A>
</H3>
<P>MySQL использует значение системной переменной <CODE>TMPDIR</CODE> как имя
пути каталога, чтобы сохранить временные файлы. Если Вы не имеете
<CODE>TMPDIR</CODE>, MySQL использует системное значение по умолчанию,
которое является обычно <TT>/tmp</TT> или <TT>/usr/tmp</TT>. Если файловая
система, содержащая Ваш временный каталог слишком маленькая, Вы должны
отредактировать скрипт <CODE>safe_mysqld</CODE>, чтобы установить
<CODE>TMPDIR</CODE> так, чтобы указать на каталог в файловой системе, где Вы
имеете достаточно места. Вы можете также устанавливать временный каталог,
используя опцию <CODE>--tmpdir</CODE> при вызове <CODE>mysqld</CODE>.</P>

<P>MySQLсоздает все временные файлы как скрытые. Это гарантирует, что
временные файлы будут удалены, если <CODE>mysqld</CODE> завершен. Недостаток
использования скрытых файлов в том, что Вы не будете видеть большой временный
файл, заполняющий файловую систему, в которой размещен временный каталог.</P>

<P>При сортировке (<CODE>ORDER BY</CODE> или <CODE>GROUP BY</CODE>) MySQL
обычно использует один или два временных файла. Максимальное дисковое
пространство, необходимое для сортировки:</P>
<PRE>
(Длина сортируемых данных+sizeof(database pointer))*
число совпадающих строк*2
</PRE>

<P>Здесь <CODE>sizeof(database pointer)</CODE> обычно 4, но может расти в
будущем для действительно больших таблиц.</P>

<P>Для некоторого запроса <CODE>SELECT</CODE> MySQL также создает временные
SQL-таблицы. Они не скрыты и имеют имена формы <TT>SQL_*</TT>.</P>

<P><CODE>ALTER TABLE</CODE> создает временную таблицу в том же самом
каталоге, где находится и первоначальная таблица.</P>

<H3><A NAME="Problems_with_mysql.sock">11.4.5 Как защитить или сменить файл
сокета MySQL <TT>/tmp/mysql.sock</TT></A>
</H3>
<P>Если Вы имеете проблемы с тем фактом, что любой может удалять сокет
MySQL <TT>/tmp/mysql.sock</TT>, Вы можете, на большинстве версий Unix,
защитить Вашу файловую систему <TT>/tmp</TT>, устанавливая липкий бит на ней.
Зайдите в систему как <CODE>root</CODE> и скомандуйте:</P>
<PRE>
shell&#62; chmod +t /tmp
</PRE>

<P>Это защитит Вашу файловую систему <TT>/tmp</TT> так, чтобы файлы могли
быть удалены только их владельцами или суперпользователем (<CODE>root</CODE>).
</P>

<P>Вы можете проверять, установлен ли липкий бит, выполняя
<CODE>ls -ld /tmp</CODE>. Если последний бит прав доступа равен
<CODE>t</CODE>, липкий бит установлен.</P>

<P><A NAME="IDX1682"></A></P>
<P>Вы можете изменять место, где MySQL помещают файл сокета, так:</P>

<UL><LI>Определите путь в глобальном или локальном файле опций. Например,
поместите в <CODE>/etc/my.cnf</CODE>:
<PRE>
[client]
socket=path-for-socket-file

[mysqld]
socket=path-for-socket-file
</PRE>

<LI>Определите это в командной строке для <CODE>safe_mysqld</CODE> и для
большинства клиентов опцией <CODE>--socket=path-for-socket-file</CODE>.

<LI>Определите путь на сокет в системной переменной
<CODE>MYSQL_UNIX_PORT</CODE>.</UL>

<P>Вы можете проверять, что сокет работает, с помощью команды:</P>
<PRE>
shell&#62; mysqladmin --socket=/path/to/socket version
</PRE>

<H3><A NAME="Timezone_problems">11.4.6 Проблемы с временными зонами</A></H3>
<P>Если Вы имеете проблему с <CODE>SELECT NOW()</CODE>, возвращающим значения
в GMT, а не по Вашему местному времени, Вы должны установить системную
переменную <CODE>TZ</CODE> к Вашему текущему часовому поясу. Это должно быть
выполнено для среды, в которой выполняется сервер, например, в скрипте
<CODE>safe_mysqld</CODE> или в <CODE>mysql.server</CODE>.</P>

<H2><A NAME="Query_Issues">11.5 Проблемы с запросами</A></H2>
<H3><A NAME="Case_sensitivity">11.5.1 Чувствительность к регистру в поиске
</A></H3>
<P>По умолчанию поиск в MySQL нечувствителен к регистру (хотя имеются
некоторые наборы символов, которые всегда чувствительны, например,
<CODE>czech</CODE>). Это означает, что, если Вы ищете <CODE>col_name LIKE
'a%'</CODE>, Вы получите все значения столбца, которые начинаются с
<CODE>A</CODE> или <CODE>a</CODE>. Если Вы хотите сделать этот поиск с учетом
регистра, используйте нечто подобное <CODE>INSTR(col_name, "A")=1</CODE>,
чтобы проверить префикс. Или используйте <CODE>STRCMP(col_name,"A")=0</CODE>,
если значение столбца было точно <CODE>"A"</CODE>.</P>

<P>Простые операции сравнения (<CODE>&#62;=, &#62;, =, &#60; ,&#60;=</CODE>,
сортировка и группировка) основаны на значении сорта каждого символа. Символы
с тем же самым значением сорта обрабатываются как тот же самый символ.</P>

<P>В старых версиях MySQL <CODE>LIKE</CODE> выполнялся по значениям,
приведенным к верхнему регистру. В более новых версиях MySQL
<CODE>LIKE</CODE> работает точно так же, как другие операторы сравнения.</P>

<P>Если Вы хотите, чтобы столбец всегда обработался в режиме чувствительности
к регистру, объявите его как <CODE>BINARY</CODE>. Подробности в разделе
"<A HREF="glava07.htm#CREATE_TABLE">7.3 Синтаксис <CODE>CREATE TABLE</CODE>
</A>".</P>

<P>Если Вы используете китайские данные в так называемом кодировании big5, Вы
должны сделать все символьные столбцы <CODE>BINARY</CODE>. Это работает
потому, что порядок сортировки символов кодирования big5 основан на
порядке ASCII кодов.</P>

<H3><A NAME="Using_DATE">11.5.2
Проблемы использования столбцов <CODE>DATE</CODE></A></H3>
<P>Формат значения <CODE>DATE</CODE> всегда <CODE>YYYY-MM-DD</CODE>. Согласно
ANSI SQL, никакой другой формат не позволяется. Вы должны использовать этот
формат в выражениях <CODE>UPDATE</CODE> и в предложении WHERE инструкций
<CODE>SELECT</CODE>. Например:</P>
<PRE>
mysql&#62; SELECT * FROM tbl_name WHERE date &#62;= '1997-05-05';
</PRE>

<P>Как дополнительное удобство MySQL автоматически преобразовывает дату в
число, если дата используется в числовом контексте (и наоборот). Также
достаточно интеллектуально обрабатывается ослабленная форма строки при
модифицировании и в предложении <CODE>WHERE</CODE>, которое сравнивает дату
со столбцом <CODE>TIMESTAMP</CODE>, <CODE>DATE</CODE> или
<CODE>DATETIME</CODE>. Ослабленная форма означает, что любой символ
пунктуации может использоваться как разделитель между частями. Например,
<CODE>1998-08-15</CODE> и <CODE>1998#08#15</CODE> являются эквивалентными.
MySQL может также преобразовывать строку не содержащую никаких разделителей
(типа <CODE>19980815</CODE>), если она имеет смысл как дата.</P>

<P>Специальная дата <CODE>0000-00-00</CODE> может быть сохранена и получена
как <CODE>0000-00-00</CODE>. При использовании даты <CODE>0000-00-00</CODE>
через <STRONG>MyODBC</STRONG>, это будет автоматически преобразовано в
<CODE>NULL</CODE> в <STRONG>MyODBC</STRONG> Version 2.50.12 и выше потому,
что ODBC не может обрабатывать этот вид даты.</P>

<P>Потому, что MySQL выполняет преобразования, описанные выше, следующие
инструкции всегда работают:</P>
<PRE>
mysql&#62; INSERT INTO tbl_name (idate) VALUES (19970505);
mysql&#62; INSERT INTO tbl_name (idate) VALUES ('19970505');
mysql&#62; INSERT INTO tbl_name (idate) VALUES ('97-05-05');
mysql&#62; INSERT INTO tbl_name (idate) VALUES ('1997.05.05');
mysql&#62; INSERT INTO tbl_name (idate) VALUES ('1997 05 05');
mysql&#62; INSERT INTO tbl_name (idate) VALUES ('0000-00-00');
mysql&#62; SELECT idate FROM tbl_name WHERE idate &#62;= '1997-05-05';
mysql&#62; SELECT idate FROM tbl_name WHERE idate &#62;= 19970505;
mysql&#62; SELECT mod(idate,100) FROM tbl_name WHERE idate &#62;= 19970505;
mysql&#62; SELECT idate FROM tbl_name WHERE idate &#62;= '19970505';
</PRE>

<P>Однако, следующее работать не будет:</P>
<PRE>
mysql&#62; SELECT idate FROM tbl_name WHERE STRCMP(idate,'19970505')=0;
</PRE>

<P><CODE>STRCMP()</CODE> представляет собой строковую функцию, так что это
преобразовывает <CODE>idate</CODE> в строку и выполняет сравнение строк. Но
она не конвертирует <CODE>19970505</CODE> в дату и не сравнивает даты.</P>

<P>Обратите внимание, что MySQL не делает никакой проверки, является или нет
дата правильной. Если Вы сохраняете неправильную дату, типа
<CODE>1998-2-31</CODE>, неправильная дата будет сохранена. Если дата не может
быть преобразована в любое приемлемое значение, <CODE>0</CODE> будет сохранен
в поле <CODE>DATE</CODE>. Это главным образом проблема быстродействия.</P>

<H3><A NAME="Problems_with_NULL">11.5.3
Проблемы со значениями <CODE>NULL</CODE></A></H3>
<P>Концепция значения <CODE>NULL</CODE> представляет собой общий источник
беспорядка для новичков в SQL, которые часто думают, что <CODE>NULL</CODE>
та же самая вещь, что и пустая строка <CODE>''</CODE>. Дело обстоит не так!
Например, следующие инструкции полностью различны:</P>
<PRE>
mysql&#62; INSERT INTO my_table (phone) VALUES (NULL);
mysql&#62; INSERT INTO my_table (phone) VALUES ("");
</PRE>

<P>Обе инструкции вставляют значение в столбец <CODE>phone</CODE>, но первые
вставят значение <CODE>NULL</CODE>, а вторая вставляет пустую строку.
Значение первой может быть расценено как "номер телефона неизвестен", а
значение второй как "не имеет никакого телефона".</P>

<P>В SQL значение <CODE>NULL</CODE> всегда неправильно в сравнении с любым
другим значением. Выражение, которое содержит <CODE>NULL</CODE>, всегда
производит значение <CODE>NULL</CODE>, если иное не обозначено в документации
для операторов и функций, включаемых в выражение. Все столбцы в следующем
примере возвращают именно <CODE>NULL</CODE>:</P>
<PRE>
mysql&#62; SELECT NULL,1+NULL,CONCAT('Invisible',NULL);
</PRE>

<P>Если Вы хотите искать значения столбца, которые являются
<CODE>NULL</CODE>, Вы не можете использовать тест <CODE>=NULL</CODE>.
Следующая инструкция не возвращает никаких строк потому, что
<CODE>expr=NULL</CODE> всегда равно FALSE для любого выражения:</P>
<PRE>
mysql&#62; SELECT * FROM my_table WHERE phone = NULL;
</PRE>

<P>Чтобы искать значения <CODE>NULL</CODE>, Вы должны использовать тест
<CODE>IS NULL</CODE>. Следующее показывает, как найти номер телефона
<CODE>NULL</CODE> и пустой номер телефона:</P>
<PRE>
mysql&#62; SELECT * FROM my_table WHERE phone IS NULL;
mysql&#62; SELECT * FROM my_table WHERE phone = "";
</PRE>

<P>В MySQL как и во многих других SQL-серверах, Вы не можете индексировать
столбцы, которые могут иметь значения <CODE>NULL</CODE>. Вы должны объявить
столбцы для индекса как <CODE>NOT NULL</CODE>. Наоборот, Вы не можете
вставлять <CODE>NULL</CODE> в индексированный столбец.</P>

<P><A NAME="IDX1696"></A>При чтении данных через <CODE>LOAD DATA
INFILE</CODE>, пустые столбцы модифицируются с <CODE>''</CODE>. Если Вы
хотите иметь в столбце значение <CODE>NULL</CODE>, Вы должны использовать
<CODE>\N</CODE> в текстовом файле. Литеральное слово <CODE>'NULL'</CODE>
может также с успехом использоваться при некоторых обстоятельствах.
Подробности есть в разделе "<A HREF="glava08.htm#LOAD_DATA">8.9 Синтаксис
<CODE>LOAD DATA INFILE</CODE></A>".</P>

<P>При использовании <CODE>ORDER BY</CODE> значения <CODE>NULL</CODE> будут
представлены первыми. Если Вы сортируете в порядке по убыванию, используя
<CODE>DESC</CODE>, значения <CODE>NULL</CODE>, понятно, окажутся в хвосте.
При использовании <CODE>GROUP BY</CODE>, все значения <CODE>NULL</CODE> будут
расценены как равные.</P>

<P>Чтобы помочь СУБД с обработкой <CODE>NULL</CODE>, Вы можете использовать
операторы <CODE>IS NULL</CODE> и <CODE>IS NOT NULL</CODE>, а также функцию
<CODE>IFNULL()</CODE>. Производительность улучшится.</P>

<P><A NAME="IDX1697"></A><A NAME="IDX1698"></A><A NAME="IDX1699"></A>
<A NAME="IDX1700"></A>Для некоторых типов столбцов значения <CODE>NULL</CODE>
обработаны особо. Если Вы вставляете <CODE>NULL</CODE> в первый столбец типа
<CODE>TIMESTAMP</CODE> в таблице, реально будут вставлены текущая дата и
время. Если Вы вставляете <CODE>NULL</CODE> в столбец с поддержкой
<CODE>AUTO_INCREMENT</CODE>, вставится следующее число в последовательности.
</P>

<H3><A NAME="Problems_with_alias">11.5.4 Проблемы с <CODE>alias</CODE></A>
</H3>
<P>Вы можете использовать псевдоним, чтобы обратиться к столбцу в
<CODE>GROUP BY</CODE>, <CODE>ORDER BY</CODE> или в части <CODE>HAVING</CODE>.
Псевдонимы могут также использоваться, чтобы дать столбцам лучшие имена:</P>
<PRE>
SELECT SQRT(a*b) as rt FROM table_name GROUP BY rt HAVING rt &#62; 0;
SELECT id,COUNT(*) AS cnt FROM table_name GROUP BY id HAVING cnt &#62; 0;
SELECT id AS "Customer identity" FROM table_name;
</PRE>

<P>Обратите внимание, что ANSI SQL не позволяет Вам обращаться к псевдониму в
предложении <CODE>WHERE</CODE>. Это потому, что, когда код <CODE>WHERE</CODE>
выполнен, значение столбца не может быть определено. Например, следующий
запрос строго <STRONG>запрещен</STRONG>:</P>
<PRE>
SELECT id,COUNT(*) AS cnt FROM table_name WHERE cnt &#62; 0 GROUP BY id;
</PRE>

<P>Инструкция <CODE>WHERE</CODE> выполнена, чтобы определить, которые строки
должны быть включены в часть <CODE>GROUP BY</CODE> в то время, как
<CODE>HAVING</CODE> используется, чтобы решить, которые строки из набора
результатов должны использоваться.</P>

<H3><A NAME="Deleting_from_related_tables">11.5.5
Удаление строк из связанных таблиц</A></H3>
<P>Поскольку MySQL не поддерживает подвыборы или использование больше, чем
одной таблицы в инструкции <CODE>DELETE</CODE>, Вы должны использовать
следующий подход, чтобы удалить строки из двух связанных таблиц:</P>

<OL><LI><CODE>SELECT</CODE> строки, основываясь на некотором условии
<CODE>WHERE</CODE> в основной таблице.
<LI><CODE>DELETE</CODE> строки в основной таблице, основываясь на том
же самом условии.
<LI><CODE>DELETE FROM связанная_таблица WHERE связанные_столбцы
IN (выбранные_строки)</CODE>.</OL>

<P>Если общее количество символов в запросе со связанными столбцами
(<CODE>related_column</CODE>) больше, чем 1048576 (значение по умолчанию
для <CODE>max_allowed_packet</CODE>), Вы должны расчленить его на меньшие
части и выполнить много инструкций <CODE>DELETE</CODE>. Вы, вероятно,
достигнете пика производительности при удалении 100-1000
<CODE>related_column</CODE> на запрос, если <CODE>related_column</CODE>
является индексом. В противном случае быстродействие независимо от числа
параметров в предложении <CODE>IN</CODE>.</P>

<H3><A NAME="No_matching_rows">11.5.6 Решение проблем с несоответствием строк
</A></H3>
<P>Если Вы имеете сложный запрос, который имеет много таблиц, а он не
возвращает никаких строк, Вы должны использовать следующую процедуру, чтобы
выяснить, что неправильно с Вашим запросом:</P>

<OL><LI>Проверьте запрос с помощью <CODE>EXPLAIN</CODE> и выправьте его, если
Вы можете найти что-то такое, что является очевидно неправильным. Подробности
в разделе "<A HREF="glava14.htm#EXPLAIN">14.2.1 Синтаксис
<CODE>EXPLAIN</CODE> (получение информации о <CODE>SELECT</CODE>)</A>".

<LI>Выберите только те поля, которые используются в предложении
<CODE>WHERE</CODE>.

<LI>Удаляйте по одной таблице из запроса, пока он не будет возвращать строки.
Если таблицы большие, хорошо использовать с запросом <CODE>LIMIT 10</CODE>.

<LI>Сделайте <CODE>SELECT</CODE> для столбца, который должен был
соответствовать в таблице, которая была последней удалена из запроса.

<LI>Если Вы сравниваете столбцы <CODE>FLOAT</CODE> или <CODE>DOUBLE</CODE> с
числовыми столбцами, которые имеют десятичные числа, Вы не можете
использовать <CODE>=</CODE>. Эта проблема общая в большинстве компьютерных
языков потому, что значения с плавающей запятой не точные значения:
<PRE>
mysql&#62; SELECT * FROM table_name WHERE float_column=3.5;
    -&#62;
mysql&#62; SELECT * FROM table_name WHERE float_column between 3.45 and 3.55;
</PRE>
В большинстве случаев замена <CODE>FLOAT</CODE> на <CODE>DOUBLE</CODE>
исправит это дело.

<LI>Если Вы все еще не можете вычислить, что идет неправильно, создайте
минимальный тест, который может быть выполнен с <CODE>mysql test &#60;
query.sql</CODE>, который показывает Ваши проблемы. Вы можете создавать файл
теста с помощью <CODE>mysqldump --quick database tables &#62;
query.sql</CODE>. Откройте файл в редакторе, удалите некоторые строки и
добавьте Вашу инструкцию выбора в конце файла. Проверьте, что Вы все еще
имеете Вашу проблему:
<PRE>
shell&#62; mysqladmin create test2
shell&#62; mysql test2 &#60; query.sql
</PRE>
Отправьте файл теста, используя <CODE>mysqlbug</CODE> на
<a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a>.</OL>

<H2><A NAME="Table_Definition_Issues">11.6 Проблемы с определениями таблиц
</A></H2>

<H3><A NAME="ALTER_TABLE_problems">11.6.1 Проблемы с <CODE>ALTER TABLE</CODE>
</A></H3>
<P><CODE>ALTER TABLE</CODE> изменяет таблицу на текущий набор символов. Если
Вы в течение <CODE>ALTER TABLE</CODE> получаете ошибку дублирования ключа, то
причиной является то, что новые наборы символов отображают разные ключи к
тому же самому значению, или что таблица разрушена, тогда Вы должны выполнить
<CODE>REPAIR TABLE</CODE> на таблице.</P>

<P>Если <CODE>ALTER TABLE</CODE> падает с ошибкой подобно этой:</P>
<PRE>
Error on rename of './database/name.frm' to
                   './database/B-a.frm' (Errcode: 17)
</PRE>

<P>Проблема может состоять в том, что MySQL потерпел крах в предыдущем
<CODE>ALTER TABLE</CODE>, и имеется старая таблица с именем <TT>A-что-то</TT>
или <TT>B-что-то</TT>. В этом случае идите в каталог данных MySQL, и удалите
там все файлы, которые имеют имена, начинающиеся с <CODE>A-</CODE> или
<CODE>B-</CODE>. Вы можете перемещать их в другое место вместо того, чтобы
удалить их сразу.</P>

<P><CODE>ALTER TABLE</CODE> работает следующим образом:</P>
<UL><LI>Создает новую таблицу под именем <TT>A-xxx</TT> с нужными изменениями.
<LI>Все строки из старой таблицы копируются в <TT>A-xxx</TT>.
<LI>Старая таблица переименуется в <TT>B-xxx</TT>.
<LI>Таблица <TT>A-xxx</TT> переименуется в старую таблицу.
<LI>Таблица <TT>B-xxx</TT> удаляется.</UL>

<P>Если что-то идет неправильно с операцией переименования, MySQL пробует
отменить изменения. Если что-то идет совсем уж неправильно (этого не должно
случиться, конечно), MySQL может оставить старую таблицу как <TT>B-xxx</TT>,
поскольку простое переименование на уровне системы должно вернуть Ваши данные
обратно в целости и сохранности.</P>

<H3><A NAME="Change_column_order">11.6.2 Как менять порядок столбцов в таблице
</A></H3>
<P>Вы должны всегда определять порядок, в котором Вы желаете получить данные:
</P>
<PRE>
SELECT col_name1, col_name2, col_name3 FROM tbl_name;
</PRE>

<P>Возвратит столбцы в порядке <CODE>col_name1</CODE>, <CODE>col_name2</CODE>,
<CODE>col_name3</CODE> в то время, как:</P>
<PRE>
SELECT col_name1, col_name3, col_name2 FROM tbl_name;
</PRE>

<P>Возвратит столбцы в порядке <CODE>col_name1</CODE>,
<CODE>col_name3</CODE>, <CODE>col_name2</CODE>.</P>

<P>Вы <STRONG>не должны</STRONG> в прикладной программе использовать
<CODE>SELECT *</CODE> и получать столбцы, основываясь на их позиции потому,
что порядок, в котором столбцы возвращены, <STRONG>НЕЛЬЗЯ
ГАРАНТИРОВАТЬ</STRONG> через какое-то время. Простое изменение Вашей базы
данных может заставить Вашу прикладную программу развалиться полностью.</P>

<P>Если по какой-то причине Вы все же хотите изменять порядок столбцов, Вы
можете сделать это следующим образом:</P>

<OL><LI>Создайте новую таблицу со столбцами в правильном порядке.
<LI>Выполните <CODE>INSERT INTO new_table SELECT fields-in-new_table-order
FROM old_table</CODE>.
<LI>Удалите или переименуйте <CODE>old_table</CODE>.
<LI>Выполните <CODE>ALTER TABLE new_table RENAME old_table</CODE>.</OL>

<H3><A NAME="Temporary_table_problems">11.6.3 Проблемы с TEMPORARY TABLE</A>
</H3>
<P>Следующее представляет собой список всех ограничений, действительных для
временных таблиц (<CODE>TEMPORARY TABLES</CODE>).</P>

<UL><LI>Временные таблицы могут быть только типов <CODE>HEAP</CODE>,
<CODE>ISAM</CODE> или <CODE>MyISAM</CODE>.

<LI>Вы не можете использовать временные таблицы больше одного раза в запросе.
Например, следующее работать не будет:
<PRE>
select * from temporary_table, temporary_table as t2;
</PRE>
Это планируется исправить в версии 4.0.

<LI>Вы не можете использовать <CODE>RENAME</CODE> для таблиц
<CODE>TEMPORARY</CODE>. Обратите внимание, что <CODE>ALTER TABLE org_name
RENAME new_name</CODE> тем не менее работает вполне корректно! Это
планируется исправить в версии 4.0.</UL>

</index></td><td width="20%">
<script type="text/javascript">
    var begun_auto_colors           = new Array();
    var begun_auto_fonts_size       = new Array();
    var begun_auto_pad              =       97517308;     // идентификатор площадки
    var begun_auto_limit            =              5;     // число объявлений выводимых на площадке
    var begun_auto_width            =            250;     // ширина блока объявлений
    begun_auto_colors[0]            =      '#0000CC';     // цвет ссылки объявлений
    begun_auto_colors[1]            =      '#000000';     // цвет текста объявления
    begun_auto_colors[2]            =      '#00CC00';     // цвет домена объявления
    begun_auto_colors[3]            =      '#FFFFFF';     // цвет фона блока объявлений
    begun_auto_fonts_size[0]        =          '9pt';     // р-мер шрифта ссылки объявлений
    begun_auto_fonts_size[1]        =          '9pt';     // р-мер шрифта текста объявления
    begun_auto_fonts_size[2]        =          '8pt';     // р-мер шрифта домена объявления
    begun_auto_fonts_size[3]        =          '8pt';     // р-мер шрифта заглушки
    var begun_block_type            =     'Vertical';     // тип блока
    var begun_rambler_type          =              1;     // цвет блока поиска Рамблер
    begun_koi8 = 1;
</script>
<script src="../../../autocontext.begun.ru/autocontext.js"
type="text/javascript"></script>
</td></tr></table>

<p><table><tr><td>
<form method="get" name="fform" onSubmit="fsearch(strf.value);
return false;">
<input type="hidden" name="clid" value="39177">
<b>Поиск</b><table><tr>
<td><input type="text" name="strf" size="15" style="font-size: 9pt" /></td></tr>
<tr><td><font size="-1"><input type="radio" name="myradio" value="0"
checked id="at_site"/>
<label for="at_site">На сайте</label><br/>
<input type="radio" name="myradio" value="1" id="at_ya">
<label for="at_ya">В Яндексе</label></font></td></tr>

<tr><td><input type="submit" value="Найти" style="font-size: 9pt"></td></tr>
</table></form></td>
<td>&nbsp;</td><td><script language="JavaScript"
src="../../../b190.takru.com/in.php@id=199275">
</script></td></tr></table></p>

<p><center><table><tr><td><font size="+1"><B>Найди своих коллег!</B></font><BR>
<script language="javascript"
src="../../../rldp.lovemesweet.ru/banner/db.js.php@rows=01&cols=05&bg=33FF33&sex=0&afrom=18&ato=99&headgif=&sf=1&nwnd=1&pmin=0&cid=RU&tid=0&smu=0&tcl1=000000&tcl2=FF0000">
</script></td>

<td><iframe src="../../../www.linuxcenter.ru/trans/list.phtml@ref=121965&n=5&price=yes"
frameborder="0" vspace="0" hspace="0" width="300" height="350" marginwidth="0"
marginheight="0" scrolling="no"></iframe></td></tr></table></center></p>

<script type="text/javascript" src="../../../bin-layer.ru/popup-686-1.js">
</script>


</BODY>
</HTML>
